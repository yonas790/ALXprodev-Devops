#!/bin/bash

POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
API_BASE_URL="https://pokeapi.co/api/v2/pokemon"
OUTPUT_DIR="pokemon_data"
RETRY_LIMIT=3

mkdir -p "$OUTPUT_DIR"

for POKEMON in "${POKEMONS[@]}"; do
  echo "Fetching data for $POKEMON..."
  ATTEMPT=1
  SUCCESS=false

  while [ "$ATTEMPT" -le "$RETRY_LIMIT" ]; do
    RESPONSE=$(curl -s -f "$API_BASE_URL/$POKEMON" -o "$OUTPUT_DIR/$POKEMON.json")

    if [ $? -eq 0 ]; then
      echo "Saved data to $OUTPUT_DIR/$POKEMON.json âœ…"
      SUCCESS=true
      break
    else
      echo "Attempt $ATTEMPT for $POKEMON failed. Retrying..."
      sleep 1  
    fi

    ((ATTEMPT++))
  done

  if [ "$SUCCESS" = false ]; then
    echo "Failed to fetch data for $POKEMON after $RETRY_LIMIT attempts" >> "$OUTPUT_DIR/error.log"
    echo "Failed to fetch data for $POKEMON after $RETRY_LIMIT attempts"
  fi

  sleep 1  
done
