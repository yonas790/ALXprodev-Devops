#!/bin/bash

output_file="pokemon_report.csv"
json_dir="pokemon_data"

if [ ! -d "$json_dir" ]; then
  echo "Error: Directory '$json_dir' not found. Run Task 2 first."
  exit 1
fi

echo "Name,Height (m),Weight (kg)" > "$output_file"

for file in "$json_dir"/*.json; do
  name=$(jq -r '.name' "$file" | sed 's/.*/\u&/')
  height_dm=$(jq -r '.height' "$file")
  weight_hg=$(jq -r '.weight' "$file")

  height_m=$(awk "BEGIN {printf \"%.2f\", $height_dm / 10}")
  weight_kg=$(awk "BEGIN {printf \"%.2f\", $weight_hg / 10}")

  echo "$name,$height_m,$weight_kg" >> "$output_file"
done

echo -e "\nCSV Report generated at: $output_file"

awk -F',' '
  NR > 1 {
    height_sum += $2
    weight_sum += $3
    count++
    print $0
  }
  END {
    if (count > 0) {
      avg_height = height_sum / count
      avg_weight = weight_sum / count
      printf "\nAverage Height: %.2f m\n", avg_height
      printf "Average Weight: %.2f kg\n", avg_weight
    }
  }
' "$output_file"
